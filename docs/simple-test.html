<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Three.js Test</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        #container { width: 100vw; height: 100vh; background: #f0f0f0; }
        #status {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            max-width: 400px;
            z-index: 1000;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #007bff; }
    </style>
</head>
<body>
    <div id="status">Initializing...</div>
    <div id="container"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.169.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.169.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        const statusEl = document.getElementById('status');
        const container = document.getElementById('container');

        function updateStatus(msg, type = 'info') {
            console.log(msg);
            statusEl.innerHTML += `<div class="${type}">${msg}</div>`;
        }

        try {
            updateStatus('Step 1: Loading Three.js...', 'info');
            const THREE = await import("three");
            updateStatus(`✓ Three.js r${THREE.REVISION} loaded`, 'success');

            updateStatus('Step 2: Creating scene...', 'info');
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf4f1ea);

            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);
            updateStatus('✓ Scene, camera, renderer created', 'success');

            updateStatus('Step 3: Loading OrbitControls...', 'info');
            const { OrbitControls } = await import("three/addons/controls/OrbitControls.js");
            const controls = new OrbitControls(camera, renderer.domElement);
            updateStatus('✓ OrbitControls loaded', 'success');

            updateStatus('Step 4: Creating geometry...', 'info');
            // Create a simple cube
            const geometry = new THREE.BoxGeometry();
            const material = new THREE.MeshBasicMaterial({ color: 0x2f9c95 });
            const cube = new THREE.Mesh(geometry, material);
            scene.add(cube);
            updateStatus('✓ Cube created', 'success');

            updateStatus('Step 5: Testing data fetch...', 'info');
            try {
                const dataUrl = new URL("data/baci_gravity_viz.json", window.location.href).href;
                const response = await fetch(dataUrl);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                updateStatus(`✓ Data loaded: ${data.rows.length} rows`, 'success');
            } catch (err) {
                updateStatus(`✗ Data fetch failed: ${err.message}`, 'error');
            }

            updateStatus('Step 6: Starting animation...', 'info');
            function animate() {
                requestAnimationFrame(animate);
                cube.rotation.x += 0.01;
                cube.rotation.y += 0.01;
                controls.update();
                renderer.render(scene, camera);
            }
            animate();
            updateStatus('✓ Animation running! You should see a rotating cube.', 'success');

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

        } catch (err) {
            updateStatus(`✗ FATAL ERROR: ${err.message}`, 'error');
            console.error(err);
        }
    </script>
</body>
</html>
